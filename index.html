<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>Haytocen Snake VIP</title>
    <style>
        :root {
            --primary: #f1c40f;
            --bg: #0b0e11;
            --surface: #1c2128;
            --text: #ffffff;
            --text-dim: #8b949e;
            --canvas-bg: #111;
            --accent: #e74c3c;
            --success: #2ecc71;
            --btn-blue: #3498db;
        }

        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; 
            overflow: hidden; touch-action: none; -webkit-user-select: none; user-select: none;
            height: 100dvh;
        }

        #main-wrapper { max-width: 500px; margin: auto; height: 100%; display: flex; flex-direction: column; }

        .header { 
            background: var(--surface); padding: 0 15px; border-bottom: 2px solid var(--primary); 
            display: flex; justify-content: space-between; align-items: center; 
            height: 50px; flex-shrink: 0; z-index: 10;
        }
        .header-left { display: flex; gap: 15px; align-items: center; font-weight: 900; font-size: 18px; }

        .content-area { flex-grow: 1; position: relative; overflow-y: auto; overflow-x: hidden; display: flex; flex-direction: column; }
        .page-section { display: none; width: 100%; min-height: 100%; flex-direction: column; align-items: center; }

        /* Game Section Styles */
        #game-section { height: 100%; overflow: hidden; justify-content: space-between; padding-bottom: 10px; box-sizing: border-box; }
        .level-info { width: 100%; display: flex; justify-content: space-between; padding: 5px 15px; box-sizing: border-box; background: rgba(0,0,0,0.3); font-size: 12px; font-weight: bold; color: var(--primary); }
        .progress-bar { width: 100%; height: 4px; background: #333; position: relative; }
        .progress-fill { height: 100%; background: var(--success); width: 0%; transition: width 0.3s; }
        
        .canvas-container { flex-grow: 1; width: 100%; display: flex; align-items: center; justify-content: center; position: relative; padding: 10px; box-sizing: border-box; }
        .canvas-wrapper { position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); border-radius: 8px; }
        canvas { display: block; background: var(--canvas-bg); border: 2px solid var(--primary); border-radius: 8px; transition: background 1s; }
        .start-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); border-radius: 8px; display: flex; align-items: center; justify-content: center; z-index: 20; flex-direction: column; }
        
        .controls-area { flex-shrink: 0; display: flex; justify-content: center; margin-bottom: 5px; }
        .controls { display: grid; grid-template-columns: repeat(3, 60px); grid-template-rows: repeat(2, 50px); gap: 6px; }
        .ctrl-btn { width: 100%; height: 100%; background: var(--surface); border: 1px solid #444; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--primary); box-shadow: 0 3px 0 #000; touch-action: manipulation; }
        .ctrl-btn:active { transform: translateY(3px); box-shadow: 0 0 0; background: #2a2f38; }

        /* Wheel Styles */
        .wheel-container { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 20px; }
        .wheel-outer { position: relative; width: 280px; height: 280px; border-radius: 50%; border: 8px solid var(--surface); overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        /* –°—Ç—Ä–µ–ª–∫–∞ —Ç–µ–ø–µ—Ä—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –≤–Ω–∏–∑ —Å–≤–µ—Ä—Ö—É, –ª–æ–≥–∏–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ –ø–æ–¥ —ç—Ç–æ */
        .wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 30px; height: 40px; background: #e74c3c; clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 25; }
        #wheel { 
            width: 100%; height: 100%; border-radius: 50%; position: relative;
            transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); 
            /* –°–µ–∫—Ç–æ—Ä–∞ –∏–¥—É—Ç –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ, –∫–∞–∂–¥—ã–π 45 –≥—Ä–∞–¥—É—Å–æ–≤ */
            background: conic-gradient(
                #f1c40f 0deg 45deg,   /* –°–µ–∫—Ç–æ—Ä 1 */
                #2c3e50 45deg 90deg,  /* –°–µ–∫—Ç–æ—Ä 2 */
                #f39c12 90deg 135deg, /* –°–µ–∫—Ç–æ—Ä 3 */
                #34495e 135deg 180deg, /* –°–µ–∫—Ç–æ—Ä 4 */
                #d4ac0d 180deg 225deg, /* –°–µ–∫—Ç–æ—Ä 5 */
                #2c3e50 225deg 270deg, /* –°–µ–∫—Ç–æ—Ä 6 */
                #e67e22 270deg 315deg, /* –°–µ–∫—Ç–æ—Ä 7 */
                #8e44ad 315deg 360deg  /* –°–µ–∫—Ç–æ—Ä 8 */
            );
        }
        .wheel-label { position: absolute; top: 50%; left: 50%; width: 50%; height: 20px; margin-top: -10px; transform-origin: left center; display: flex; align-items: center; justify-content: flex-end; font-weight: 900; font-size: 12px; padding-right: 25px; box-sizing: border-box; color: #fff; text-shadow: 1px 1px 2px #000; }
        
        /* –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞–¥–ø–∏—Å–µ–π —Ç–æ—á–Ω–æ –≤ —Ü–µ–Ω—Ç—Ä —Å–µ–∫—Ç–æ—Ä–æ–≤ */
        .l1 { transform: rotate(22.5deg); color: #000; text-shadow: none; } 
        .l2 { transform: rotate(67.5deg); } 
        .l3 { transform: rotate(112.5deg); color: #000; text-shadow: none; } 
        .l4 { transform: rotate(157.5deg); } 
        .l5 { transform: rotate(202.5deg); color: #000; text-shadow: none; } 
        .l6 { transform: rotate(247.5deg); } 
        .l7 { transform: rotate(292.5deg); color: #000; text-shadow: none; } 
        .l8 { transform: rotate(337.5deg); }

        .scrollable-content { padding: 15px; width: 100%; box-sizing: border-box; }
        .card { background: var(--surface); padding: 15px; border-radius: 16px; width: 100%; margin-bottom: 12px; border: 1px solid #333; box-sizing: border-box; }
        .btn-main { padding: 10px 25px; border-radius: 10px; border: none; background: var(--primary); font-weight: 900; font-size: 14px; color: #000; cursor: pointer; transition: 0.2s; }
        .btn-main:disabled { background: #555; color: #888; cursor: not-allowed; }
        .btn-buy { padding: 8px 20px; border-radius: 10px; border: none; background: var(--btn-blue); font-weight: 900; font-size: 14px; color: #fff; cursor: pointer; box-shadow: 0 3px 0 #1e5a82; }
        .btn-withdraw { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--success); font-weight: 900; font-size: 16px; color: #000; cursor: pointer; margin-top: 10px; }
        .btn-withdraw:disabled { background: #444; color: #777; cursor: not-allowed; }
        .shop-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .nav-bar { background: var(--surface); padding: 5px 0 20px; border-top: 1px solid #333; height: 65px; flex-shrink: 0; display: flex; z-index: 50; }
        .nav-item { flex: 1; text-align: center; color: var(--text-dim); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-item span { font-size: 20px; margin-bottom: 2px; }
        .nav-item div { font-size: 9px; font-weight: 800; text-transform: uppercase; }
        .nav-item.active { color: var(--primary); transform: scale(1.1); transition: transform 0.2s; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        .exchange-row { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin: 10px 0; font-weight: bold; font-size: 18px; }
    </style>
</head>
<body>
    <div id="main-wrapper">
        <div class="header">
            <div class="header-left">
                <span>üêç <span id="score">0</span></span>
            </div>
            <div style="text-align: right;">
                <span style="font-size: 9px; opacity: 0.7;">‘≤‘±‘º‘±’Ü’ç</span><br>
                <span style="color: var(--primary); font-weight: 900; font-size: 14px;"><span id="balance">0</span> HT</span>
            </div>
        </div>

        <div class="content-area">
            <div id="game-section" class="page-section" style="display: flex;">
                <div class="level-info">
                    <span>LEVEL <span id="level-display">1</span></span>
                    <span><span id="level-progress-text">0</span> / 40</span>
                </div>
                <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
                
                <div class="canvas-container">
                    <div class="canvas-wrapper" id="canvasWrapper">
                        <canvas id="gameCanvas"></canvas>
                        <div id="startOverlay" class="start-overlay">
                            <h2 style="margin: 0 0 10px 0; color: var(--primary);">LEVEL <span id="overlay-level">1</span></h2>
                            <button id="startBtn" class="btn-main" onclick="startGame()">‘Ω‘±’Ç‘±‘º</button>
                        </div>
                    </div>
                </div>
                <div class="controls-area">
                    <div class="controls">
                        <div class="ctrl-btn" style="grid-column:2" onpointerdown="handleControl(event, 'UP')">‚ñ≤</div>
                        <div class="ctrl-btn" style="grid-column:1; grid-row:2" onpointerdown="handleControl(event, 'LEFT')">‚óÄ</div>
                        <div class="ctrl-btn" style="grid-column:3; grid-row:2" onpointerdown="handleControl(event, 'RIGHT')">‚ñ∂</div>
                        <div class="ctrl-btn" style="grid-column:2; grid-row:2" onpointerdown="handleControl(event, 'DOWN')">‚ñº</div>
                    </div>
                </div>
            </div>

            <div id="wheel-section" class="page-section scrollable-content">
                <div class="wheel-container">
                    <h2 style="color: var(--primary); margin: 0;">‘±’∂’´’æ</h2>
                    <div class="wheel-outer">
                        <div class="wheel-pointer"></div>
                        <div id="wheel">
                            <div class="wheel-label l1">1 HT</div>
                            <div class="wheel-label l2">0 HT</div>
                            <div class="wheel-label l3">‘ø’ê‘ø‘ª’Ü</div>
                            <div class="wheel-label l4">1 ‚≠ê</div>
                            <div class="wheel-label l5">5 HT</div>
                            <div class="wheel-label l6">10 HT</div>
                            <div class="wheel-label l7">25 HT</div>
                            <div class="wheel-label l8">VIP 1’ï÷Ä</div>
                        </div>
                    </div>
                    <button id="spinBtn" class="btn-main" style="width: 150px;" onclick="spinWheel()">’ä’è’è‘µ‘º</button>
                    <p id="wheel-msg" style="color: var(--primary); font-weight: bold; min-height: 20px; text-align: center; margin-top: 10px;"></p>
                </div>
            </div>

            <div id="shop-section" class="page-section scrollable-content">
                <h2 style="text-align: center; color: var(--primary); margin-top:0;">üíé VIP ‘Ω‘±’Ü’à’í‘π</h2>
                <div class="card">
                    <ul style="padding-left: 20px; margin:0; font-size: 13px; color: #ddd;">
                        <li><b>2x ‘≤’∏’∂’∏÷Ç’Ω</b> ’≠’°’≤’∏÷Ç’¥</li>
                        <li><b>2x ’Ä’°’≤’©’°’∂’°’Ø</b> ‘±’∂’´’æ’∏÷Ç’¥</li>
                        <li>üí∞ ’Ä’°’∂’¥’°’∂ ’¨’´’¥’´’ø <b>2500 HT</b></li>
                    </ul>
                </div>
                <div class="card">
                    <div class="shop-item"><div><b>5 ’ï’ê</b></div><button class="btn-buy" onclick="mockPurchase()">20 ‚≠ê</button></div>
                    <div class="shop-item"><div style="color: var(--primary);"><b>15 ’ï’ê</b></div><button class="btn-buy" onclick="mockPurchase()">150 ‚≠ê</button></div>
                    <div class="shop-item"><div style="color: #e74c3c;"><b>30 ’ï’ê</b></div><button class="btn-buy" onclick="mockPurchase()">500 ‚≠ê</button></div>
                </div>
            </div>

            <div id="bonus-section" class="page-section scrollable-content">
                <div class="card" style="text-align: center; margin-top: 20px;">
                    <h2>’ï÷Ä’°’Ø’°’∂ ’¢’∏’∂’∏÷Ç’Ω</h2>
                    <div style="font-size: 80px; margin: 20px;">üéÅ</div>
                    <button id="claimBtn" class="btn-main" style="width:100%;" onclick="claimDailyBonus()">‘≤‘±’ë‘µ‘º</button>
                    <p id="bonus-timer" style="margin-top: 15px; font-size: 14px; color: #e74c3c; font-weight: bold;"></p>
                </div>
            </div>

            <div id="profile-section" class="page-section scrollable-content">
                <div class="card" style="text-align: center;">
                    <p style="margin:0; font-size: 14px;">’Å’•÷Ä ’∞’°’∑’´’æ’®:</p>
                    <h1 style="color: var(--primary); font-size: 32px; margin: 5px 0;"><span id="profile-balance">0</span> HT</h1>
                    <p id="vip-status-profile" style="font-size: 14px; margin: 5px 0;"></p>
                </div>
                <div class="card" style="border: 2px solid var(--success);">
                    <h3 style="margin: 0; color: var(--success);">üí∏ ’ì’∏’≠’°’∂’°’Ø’∏÷Ç’¥</h3>
                    <div class="exchange-row">
                        <span style="color: var(--primary);"><span id="withdraw-limit-text">5000</span> HT</span>
                        <span>‚û°Ô∏è</span>
                        <span style="color: var(--success);">1 $</span>
                    </div>
                    <p id="withdraw-status" style="font-size: 12px; text-align: center; margin: 5px 0;">‘≤’•’º’∂’∏÷Ç’¥...</p>
                    <button id="withdrawBtn" class="btn-withdraw" onclick="withdrawMoney()">’ì’à‘Ω‘±’Ü‘±‘ø‘µ‘º</button>
                </div>
                <div class="card" style="border-left: 4px solid #2481cc;">
                    <h3>ü§ù ’å’•÷Ü’•÷Ä’°’¨</h3>
                    <p style="font-size: 13px;">‘∏’∂’Ø’•÷Ä’∏’ª ’∞’°’¥’°÷Ä: <span style="color: var(--primary);">+15 HT</span></p>
                    <button class="btn-main" style="width:100%; background:#2481cc; color:#fff;" onclick="shareGame()">’Ä’ê‘±’é‘ª’ê‘µ‘º</button>
                </div>
            </div>
        </div>

        <div class="nav-bar">
            <div id="nav-game" class="nav-item active" onclick="showTab('game')"><span>üéÆ</span><div>‘Ω‘±’Ç</div></div>
            <div id="nav-bonus" class="nav-item" onclick="showTab('bonus')"><span>üíé</span><div>‘≤’à’Ü’à’í’ç</div></div>
            <div id="nav-wheel" class="nav-item" onclick="showTab('wheel')"><span>üé°</span><div>‘±’Ü‘ª’é</div></div>
            <div id="nav-shop" class="nav-item" onclick="showTab('shop')"><span>üõí</span><div>VIP</div></div>
            <div id="nav-profile" class="nav-item" onclick="showTab('profile')"><span>üë§</span><div>‘µ’ç</div></div>
        </div>
    </div>

    <div id="modal" class="overlay">
        <h2 style="color: #e74c3c;">‘Ω‘±’Ç’Ü ‘±’é‘±’ê’è’é‘µ’ë</h2>
        <p style="color: #fff;">’Ñ’´’°’æ’∏÷Ä: <span id="end-score" style="font-weight: bold; color: var(--primary);">0</span></p>
        <button class="btn-main" onclick="closeModal()">‘ø’ê‘ø‘ª’Ü</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ---
        let box = 20, rows = 20, cols = 20;
        let snake=[], food={}, d, isRunning=false;
        let points = parseInt(localStorage.getItem('ht_balance')) || 0;
        
        // –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π
        let level = parseInt(localStorage.getItem('game_level')) || 1;
        let levelProgress = 0; // –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å (0-40)
        const LEVEL_GOAL = 40;
        const levelColors = ['#111', '#0d1b2a', '#1e0000', '#1a1a00', '#001a1a']; // –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ñ–æ–Ω–∞

        // VIP —Å–∏—Å—Ç–µ–º–∞
        let vipExpiry = parseInt(localStorage.getItem('vipExpiry')) || 0;
        let isVip = false;

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function resizeGame() {
            const container = document.querySelector('.canvas-container');
            const size = Math.min(container.clientWidth - 10, container.clientHeight - 10);
            box = Math.floor(size / 20); 
            canvas.width = box * 20; canvas.height = box * 20;
            document.getElementById('canvasWrapper').style.width = canvas.width + 'px'; 
            document.getElementById('canvasWrapper').style.height = canvas.height + 'px';
        }

        function initGame() {
            resizeGame();
            snake = [{x: 5*box, y: 10*box}, {x: 4*box, y: 10*box}, {x: 3*box, y: 10*box}];
            food = spawnItem(); 
            d = "RIGHT"; 
            levelProgress = 0; // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤–Ω—É—Ç—Ä–∏ —É—Ä–æ–≤–Ω—è –ø—Ä–∏ –Ω–æ–≤–æ–π –∏–≥—Ä–µ
            updateLevelUI();
            checkVip(); 
            updateUI(); 
            draw();
            checkDailyBonus(); // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–µ—Ä–∞ –±–æ–Ω—É—Å–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        }

        function spawnItem() { 
            return { x: Math.floor(Math.random() * cols) * box, y: Math.floor(Math.random() * rows) * box }; 
        }

        function startGame() { 
            document.getElementById('startOverlay').style.display = 'none'; 
            isRunning = true; 
            initGame(); 
            run(); 
        }

        // --- –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ---
        function run() {
            if(!isRunning) return;
            
            let hx = snake[0].x, hy = snake[0].y;
            if(d=="LEFT") hx -= box; if(d=="UP") hy -= box;
            if(d=="RIGHT") hx += box; if(d=="DOWN") hy += box;

            // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
            if(hx < 0 || hx >= canvas.width || hy < 0 || hy >= canvas.height || snake.some(s => s.x === hx && s.y === hy)) { 
                endGame(); return; 
            }

            // –ï–¥–∞
            if(hx === food.x && hy === food.y) { 
                let gain = isVip ? 2 : 1;
                points += gain; 
                levelProgress += 1;
                
                // –õ–û–ì–ò–ö–ê –£–†–û–í–ù–ï–ô
                if(levelProgress >= LEVEL_GOAL) {
                    level++;
                    levelProgress = 0;
                    localStorage.setItem('game_level', level);
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —Å–º–µ–Ω—ã —É—Ä–æ–≤–Ω—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
                }

                food = spawnItem(); 
                updateLevelUI();
            } else { 
                snake.pop(); 
            }

            snake.unshift({x: hx, y: hy}); 
            draw(); 
            updateUI(); 
            
            // –°–∫–æ—Ä–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º
            let speed = Math.max(50, 150 - (level * 5));
            setTimeout(run, speed);
        }

        function draw() {
            // –§–æ–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è (—Ü–∏–∫–ª–∏—á–Ω–æ)
            let colorIndex = (level - 1) % levelColors.length;
            ctx.fillStyle = levelColors[colorIndex]; 
            ctx.fillRect(0,0,canvas.width,canvas.height);

            // –ó–º–µ–π–∫–∞
            for(let i=0; i<snake.length; i++) {
                if(i == 0) { 
                    ctx.font = box + "px Arial"; 
                    ctx.fillText("üêç", snake[i].x, snake[i].y + box*0.8); 
                } else { 
                    ctx.fillStyle = isVip ? "#f1c40f" : "#2ecc71"; // –ó–æ–ª–æ—Ç–∞—è –∑–º–µ—è –¥–ª—è VIP
                    ctx.fillRect(snake[i].x+1, snake[i].y+1, box-2, box-2); 
                }
            }
            // –ï–¥–∞
            ctx.font = box + "px Arial"; 
            ctx.fillText("üçé", food.x, food.y + box*0.8);
        }

        function updateLevelUI() {
            document.getElementById('level-display').innerText = level;
            document.getElementById('overlay-level').innerText = level;
            document.getElementById('level-progress-text').innerText = levelProgress;
            let percent = (levelProgress / LEVEL_GOAL) * 100;
            document.getElementById('progress-fill').style.width = percent + '%';
        }

        function handleControl(e, dir) { 
            e.preventDefault(); 
            if(dir=="UP" && d!="DOWN") d="UP"; if(dir=="DOWN" && d!="UP") d="DOWN";
            if(dir=="LEFT" && d!="RIGHT") d="LEFT"; if(dir=="RIGHT" && d!="LEFT") d="RIGHT";
        }

        function endGame() { 
            isRunning = false; 
            document.getElementById('end-score').innerText = points;
            document.getElementById('modal').style.display = 'flex'; 
        }

        function closeModal() { 
            document.getElementById('modal').style.display = 'none'; 
            document.getElementById('startOverlay').style.display = 'flex'; 
        }

        // --- –õ–û–ì–ò–ö–ê –ö–û–õ–ï–°–ê (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø) ---
        // –°–µ–∫—Ç–æ—Ä–∞ –∫–æ–ª–µ—Å–∞ –≤ –ø–æ—Ä—è–¥–∫–µ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ –Ω–∞—á–∏–Ω–∞—è —Å 0 –≥—Ä–∞–¥—É—Å–æ–≤ (–≤–µ—Ä—Ö)
        const wheelSectors = [
            { label: "1 HT", val: 1, type: 'ht' },    // 0-45 deg
            { label: "0 HT", val: 0, type: 'ht' },    // 45-90 deg
            { label: "‘ø’ê‘ø‘ª’Ü", val: 0, type: 'again' }, // 90-135 deg
            { label: "1 ‚≠ê", val: 0, type: 'star' },  // 135-180 deg
            { label: "5 HT", val: 5, type: 'ht' },    // 180-225 deg
            { label: "10 HT", val: 10, type: 'ht' },  // 225-270 deg
            { label: "25 HT", val: 25, type: 'ht' },  // 270-315 deg
            { label: "VIP", val: 0, type: 'vip' }     // 315-360 deg
        ];
        
        let canSpin = true;

        function spinWheel() {
            if(!canSpin) return;
            const msg = document.getElementById('wheel-msg');
            msg.innerText = "";

            // 1. –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–µ–∫—Ç–æ—Ä –ó–ê–†–ê–ù–ï–ï
            const sectorIndex = Math.floor(Math.random() * wheelSectors.length);
            const prize = wheelSectors[sectorIndex];

            // 2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É–≥–æ–ª
            // –®–∏—Ä–∏–Ω–∞ –æ–¥–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞ 45 –≥—Ä–∞–¥—É—Å–æ–≤.
            // –ß—Ç–æ–±—ã —Å–µ–∫—Ç–æ—Ä –æ–∫–∞–∑–∞–ª—Å—è –Ω–∞–≤–µ—Ä—Ö—É (–ø–æ–¥ —Å—Ç—Ä–µ–ª–∫–æ–π), –∫–æ–ª–µ—Å–æ –Ω—É–∂–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã —ç—Ç–æ—Ç —Å–µ–∫—Ç–æ—Ä –±—ã–ª –Ω–∞ –æ—Ç–º–µ—Ç–∫–µ 0 (–∏–ª–∏ 360).
            // –§–æ—Ä–º—É–ª–∞: (360 * –ø–æ–ª–Ω—ã–µ –æ–±–æ—Ä–æ—Ç—ã) - (—É–≥–æ–ª –Ω–∞—á–∞–ª–∞ —Å–µ–∫—Ç–æ—Ä–∞ + –ø–æ–ª–æ–≤–∏–Ω–∞ —Å–µ–∫—Ç–æ—Ä–∞)
            // –ù–æ CSS transform rotate –∫—Ä—É—Ç–∏—Ç –ø–æ —á–∞—Å–æ–≤–æ–π.
            // –ß—Ç–æ–±—ã —Å–µ–∫—Ç–æ—Ä N –æ–∫–∞–∑–∞–ª—Å—è –Ω–∞–≤–µ—Ä—Ö—É, –Ω—É–∂–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç—å –∫–æ–ª–µ—Å–æ –Ω–∞: 360 - (AngleOfSector).
            
            const sectorAngle = 45;
            const targetAngle = 360 - (sectorIndex * sectorAngle + sectorAngle / 2); // –¶–µ–Ω—Ç—Ä —Å–µ–∫—Ç–æ—Ä–∞
            const totalSpins = 360 * 5; // –ú–∏–Ω–∏–º—É–º 5 –æ–±–æ—Ä–æ—Ç–æ–≤
            const finalDeg = totalSpins + targetAngle;

            canSpin = false;
            document.getElementById('wheel').style.transform = `rotate(${finalDeg}deg)`;

            setTimeout(() => {
                // 3. –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–∏–∑—É–∞–ª—å–Ω–æ–π
                let winText = "";
                if(prize.type === 'ht') {
                    let amount = prize.val;
                    if(isVip && amount > 0) amount *= 2; // VIP x2
                    points += amount;
                    winText = `‘¥’∏÷Ç÷Ñ ’∑’°’∞’•÷Å’´÷Ñ ${amount} HT!`;
                } else if (prize.type === 'again') {
                    winText = "’ì’∏÷Ä’±’´÷Ä ’Ø÷Ä’Ø’´’∂!";
                } else if (prize.type === 'star') {
                    winText = "’á’°’∞’•÷Å’´÷Ñ 1 ’°’Ω’ø’≤ (Beta)";
                } else if (prize.type === 'vip') {
                    winText = "VIP 1 ’ï÷Ä (Beta)";
                }

                msg.innerText = winText;
                updateUI();
                canSpin = true;
                // –°–±—Ä–æ—Å –≤—Ä–∞—â–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –ª—É—á—à–µ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–∫ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)
                 document.getElementById('wheel').style.transition = 'none';
                 document.getElementById('wheel').style.transform = `rotate(${targetAngle}deg)`;
                 setTimeout(() => { document.getElementById('wheel').style.transition = 'transform 4s cubic-bezier(0.1, 0, 0.1, 1)'; }, 50);

            }, 4000);
        }

        // --- –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –¢–ê–ô–ú–ï–†) ---
        function claimDailyBonus() {
            const now = Date.now();
            const lastBonus = parseInt(localStorage.getItem('lastBonusTime')) || 0;
            const cooldown = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞ –≤ –º—Å

            if (now - lastBonus < cooldown) {
                return; // –ö–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
            }

            // –°–ª—É—á–∞–π–Ω—ã–π –±–æ–Ω—É—Å –æ—Ç 10 –¥–æ 50
            const randomBonus = Math.floor(Math.random() * 40) + 10;
            const finalBonus = isVip ? randomBonus * 2 : randomBonus;
            
            points += finalBonus;
            localStorage.setItem('lastBonusTime', now);
            
            alert(`‘¥’∏÷Ç÷Ñ ’Ω’ø’°÷Å’°÷Ñ ${finalBonus} HT!`);
            checkDailyBonus();
            updateUI();
        }

        function checkDailyBonus() {
            const now = Date.now();
            const lastBonus = parseInt(localStorage.getItem('lastBonusTime')) || 0;
            const cooldown = 24 * 60 * 60 * 1000;
            const btn = document.getElementById('claimBtn');
            const timerText = document.getElementById('bonus-timer');

            if (now - lastBonus < cooldown) {
                btn.disabled = true;
                btn.innerText = "’é‘µ’ê‘±‘¥‘±’ê’Å‘ª’ê ‘±’é‘µ‘º‘ª ’à’í’á";
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å
                const diff = cooldown - (now - lastBonus);
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                timerText.innerText = `’Ä’°’ª’∏÷Ä’§’®’ù ${hours} ’™’°’¥ ${minutes} ÷Ä’∏’∫’•’´÷Å`;
            } else {
                btn.disabled = false;
                btn.innerText = "‘≤‘±’ë‘µ‘º";
                timerText.innerText = "’Ä’°’Ω’°’∂’•’¨’´ ’ß!";
            }
        }

        // --- VIP & –í–´–í–û–î (–ó–ê–ì–õ–£–®–ö–ò) ---
        function mockPurchase() {
            alert("‚ö†Ô∏è ’é’≥’°÷Ä’°’µ’´’∂ ’∞’°’¥’°’Ø’°÷Ä’£’® ’£’ø’∂’æ’∏÷Ç’¥ ’ß ’¥’∑’°’Ø’¥’°’∂ ÷É’∏÷Ç’¨’∏÷Ç’¥: ‘±’Ω’ø’≤’•÷Ä’® ’´÷Ä’°’Ø’°’∂ ’∞’°’∑’æ’´÷Å ’π’•’∂ ’£’°’∂’±’æ’•’¨:");
        }

        function withdrawMoney() {
            const limit = isVip ? 2500 : 5000;
            if(points >= limit) {
                alert("‚úÖ ’Ä’°’µ’ø’® ’®’∂’§’∏÷Ç’∂’æ’°’Æ ’ß: ‘≥’∏÷Ç’¥’°÷Ä’® ’Ø÷É’∏’≠’°’∂÷Å’æ’´ 24 ’™’°’¥’æ’° ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥ (Test Mode)");
            } else {
                alert(`‚ùå ‘±’∂’¢’°’æ’°÷Ä’°÷Ä ’¥’´’ª’∏÷Å’∂’•÷Ä: ‘±’∂’∞÷Ä’°’™’•’∑’ø ’ß ${limit} HT`);
            }
        }

        function checkVip() {
            isVip = Date.now() < vipExpiry;
            document.getElementById('vip-status-profile').innerText = isVip ? "‚ú® VIP ‘±’Ø’ø’´’æ ’ß" : "’ç’∏’æ’∏÷Ä’°’Ø’°’∂ ’∞’°’∑’´’æ";
            document.getElementById('vip-status-profile').style.color = isVip ? "#f1c40f" : "#888";
        }

        function shareGame() {
            const botUsername = "MyCoinFMBot"; // –ó–∞–º–µ–Ω–∏ –Ω–∞ –∏–º—è —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞
            const userId = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe.user) 
                ? window.Telegram.WebApp.initDataUnsafe.user.id : "";
            
            const link = `https://t.me/${botUsername}?start=${userId}`;
            const msg = "‘Ω’°’≤’° Snake ÷á ’æ’°’Ω’ø’°’Ø’´÷Ä HT ’ø’∏’Ø’•’∂’∂’•÷Ä!";
            
            if(window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.openTelegramLink(`https://t.me/share/url?url=${link}&text=${msg}`);
            } else {
                window.open(`https://t.me/share/url?url=${link}&text=${msg}`);
            }
        }

        // --- –û–ë–©–ò–ô UI ---
        function updateUI() {
            localStorage.setItem('ht_balance', points);
            document.getElementById('balance').innerText = points;
            document.getElementById('profile-balance').innerText = points;
            const limit = isVip ? 2500 : 5000;
            document.getElementById('withdraw-limit-text').innerText = limit;
            
            const wBtn = document.getElementById('withdrawBtn');
            const wStatus = document.getElementById('withdraw-status');
            
            if(points >= limit) {
                wBtn.disabled = false;
                wStatus.innerText = "’Ä’°’Ω’°’∂’•’¨’´ ’ß!";
                wStatus.style.color = "#2ecc71";
            } else {
                wBtn.disabled = true;
                wStatus.innerText = `’ä’•’ø÷Ñ ’ß ÷á’Ω ${limit - points} HT`;
                wStatus.style.color = "#777";
            }
        }

        function showTab(t) {
            document.querySelectorAll('.page-section').forEach(e => e.style.display='none');
            document.getElementById(t+'-section').style.display = (t === 'game') ? 'flex' : 'block';
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            document.getElementById('nav-'+t).classList.add('active');
            
            if(t === 'game') resizeGame();
            if(t === 'bonus') checkDailyBonus();
        }

        window.onload = () => { 
            if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.expand(); 
            initGame(); 
            showTab('game'); 
            // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–π–º–µ—Ä–∞ –±–æ–Ω—É—Å–∞
            setInterval(checkDailyBonus, 60000); 
        };
    </script>
</body>
</html>
