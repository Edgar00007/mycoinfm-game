<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>MyCoinFM - Snake & Shop</title>
    <style>
        :root {
            --primary: #f1c40f;
            --bg: #0b0e11;
            --surface: #1c2128;
            --text: #ffffff;
            --text-dim: #8b949e;
        }

        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            overflow: hidden; touch-action: none;
        }

        #main-wrapper { max-width: 500px; margin: auto; height: 100vh; display: flex; flex-direction: column; }

        /* –®–∞–ø–∫–∞ */
        .header { 
            background: var(--surface); padding: 12px 15px; 
            border-bottom: 2px solid var(--primary); display: flex; 
            justify-content: space-between; align-items: center;
        }

        /* –°–µ–∫—Ü–∏–∏ */
        .page-section { display: none; flex-grow: 1; padding: 15px; overflow-y: auto; }
        #game-section { display: flex; flex-direction: column; align-items: center; background: #161b22; }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .shop-card { 
            background: var(--surface); border: 1px solid #30363d; 
            border-radius: 12px; padding: 15px; text-align: center; 
        }
        .buy-btn { 
            margin-top: 10px; width: 100%; padding: 8px; 
            background: var(--primary); border: none; border-radius: 8px; font-weight: bold; 
        }

        /* –ö–∞–Ω–≤–∞—Å */
        canvas { background: #000; border: 2px solid #30363d; border-radius: 8px; width: 100%; max-width: 300px; }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        .controls { display: grid; grid-template-columns: repeat(3, 60px); gap: 10px; margin-top: 15px; }
        .ctrl-btn { 
            width: 60px; height: 60px; background: #21262d; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 24px;
        }
        .ctrl-up { grid-column: 2; }
        .ctrl-left { grid-column: 1; }
        .ctrl-right { grid-column: 3; }
        .ctrl-down { grid-column: 2; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-bar { display: flex; background: var(--surface); padding: 10px 0 20px 0; border-top: 1px solid #30363d; }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: var(--text-dim); }
        .nav-item.active { color: var(--primary); }
        .nav-item span { display: block; font-size: 20px; }
    </style>
</head>
<body>
    <div id="main-wrapper">
        <div class="header">
            <span>üêç <span id="score">0</span></span>
            <span style="color: var(--primary);"><span id="balance">0</span> HT</span>
        </div>

        <div id="game-section" class="page-section" style="display: flex;">
            <button id="startBtn" style="padding: 15px 30px; background: var(--primary); border:none; border-radius:10px; margin-top: 20px;" onclick="startGame()">–ò–ì–†–ê–¢–¨</button>
            <canvas id="gameCanvas" style="margin-top: 20px;"></canvas>
            <div class="controls">
                <div class="ctrl-btn ctrl-up" onclick="setDirection('UP')">‚ñ≤</div>
                <div class="ctrl-btn ctrl-left" onclick="setDirection('LEFT')">‚óÄ</div>
                <div class="ctrl-btn ctrl-right" onclick="setDirection('RIGHT')">‚ñ∂</div>
                <div class="ctrl-btn ctrl-down" onclick="setDirection('DOWN')">‚ñº</div>
            </div>
        </div>

        <div id="shop-section" class="page-section">
            <h2 style="text-align:center">–ú–∞–≥–∞–∑–∏–Ω Stars</h2>
            <div class="shop-grid">
                <div class="shop-card">
                    <div>üí∞ 100 HT</div>
                    <div style="color:var(--primary)">10 ‚≠ê</div>
                    <button class="buy-btn" onclick="requestPay(100, 10)">–ö–£–ü–ò–¢–¨</button>
                </div>
                <div class="shop-card">
                    <div>üíé 500 HT</div>
                    <div style="color:var(--primary)">50 ‚≠ê</div>
                    <button class="buy-btn" onclick="requestPay(500, 50)">–ö–£–ü–ò–¢–¨</button>
                </div>
            </div>
        </div>

        <div class="nav-bar">
            <div class="nav-item active" onclick="showTab('game')"><span>üéÆ</span>–ò–ì–†–ê</div>
            <div class="nav-item" onclick="showTab('shop')"><span>üõí</span>–®–û–ü</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let points = parseInt(localStorage.getItem('ht_balance')) || 0;
        let score = 0;
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const box = 15;
        canvas.width = 300;
        canvas.height = 300;

        let snake, food, d, gameLoop;

        function updateUI() {
            document.getElementById('balance').innerText = points;
            document.getElementById('score').innerText = score;
        }

        function showTab(id) {
            document.querySelectorAll('.page-section').forEach(s => s.style.display = 'none');
            document.getElementById(id + '-section').style.display = (id === 'game' ? 'flex' : 'block');
        }

        // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã (–ø–æ–∫–∞ –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
        function requestPay(amount, stars) {
            tg.showConfirm(`–ö—É–ø–∏—Ç—å ${amount} HT –∑–∞ ${stars} –∑–≤—ë–∑–¥?`, (ok) => {
                if(ok) {
                    points += amount;
                    localStorage.setItem('ht_balance', points);
                    updateUI();
                    tg.showAlert("–û–ø–ª–∞—Ç–∞ (—Ç–µ—Å—Ç) –ø—Ä–æ—à–ª–∞!");
                }
            });
        }

        function startGame() {
            document.getElementById('startBtn').style.display = 'none';
            snake = [{x: 10 * box, y: 10 * box}];
            d = "UP";
            score = 0;
            generateFood();
            if(gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(draw, 150);
        }

        function generateFood() {
            food = {
                x: Math.floor(Math.random() * 20) * box,
                y: Math.floor(Math.random() * 20) * box
            };
        }

        function setDirection(dir) { d = dir; }

        function draw() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for(let i=0; i<snake.length; i++) {
                ctx.fillStyle = (i === 0) ? "#f1c40f" : "#2ecc71";
                ctx.fillRect(snake[i].x, snake[i].y, box, box);
            }

            ctx.fillStyle = "red";
            ctx.fillRect(food.x, food.y, box, box);

            let headX = snake[0].x;
            let headY = snake[0].y;

            if(d === "LEFT") headX -= box;
            if(d === "UP") headY -= box;
            if(d === "RIGHT") headX += box;
            if(d === "DOWN") headY += box;

            if(headX === food.x && headY === food.y) {
                score++;
                points++;
                localStorage.setItem('ht_balance', points);
                generateFood();
                updateUI();
            } else {
                snake.pop();
            }

            let newHead = {x: headX, y: headY};

            if(headX < 0 || headX >= canvas.width || headY < 0 || headY >= canvas.height) {
                clearInterval(gameLoop);
                document.getElementById('startBtn').style.display = 'block';
                tg.showAlert("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!");
            }

            snake.unshift(newHead);
        }

        updateUI();
    </script>
</body>
</html>
